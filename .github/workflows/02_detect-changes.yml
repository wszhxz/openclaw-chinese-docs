name: 02_OpenClaw_Check_For_Translation_Tasks

on:
  workflow_run:
    workflows: ["01_OpenClaw_Compare_Docs_Directories"]
    types: [completed, success]
  workflow_dispatch:  # 允许手动触发

jobs:
  check-translation-tasks:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    outputs:
      has_translation_tasks: ${{ steps.check.outputs.has_translation_tasks }}
      file_count: ${{ steps.check.outputs.file_count }}
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        fetch-depth: 0

    - name: Check if temp_for_translation directory has content
      id: check
      run: |
        if [ -d "temp_for_translation" ] && [ -n "$(ls -A temp_for_translation)" ]; then
          FILE_COUNT=$(find temp_for_translation -name "*.md" -type f | wc -l)
          echo "has_translation_tasks=true" >> $GITHUB_OUTPUT
          echo "file_count=$FILE_COUNT" >> $GITHUB_OUTPUT
          echo "Found $FILE_COUNT files needing translation"
        else
          echo "has_translation_tasks=false" >> $GITHUB_OUTPUT
          echo "file_count=0" >> $GITHUB_OUTPUT
          echo "No files need translation"
        fi

    - name: Report translation tasks
      run: |
        if [ "${{ steps.check.outputs.has_translation_tasks }}" = "true" ]; then
          echo "Ready to translate ${{ steps.check.outputs.file_count }} files"
          find temp_for_translation -name "*.md" -type f | head -10
        else
          echo "No translation tasks found"
        fi
