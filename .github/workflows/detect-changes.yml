name: OpenClaw Docs - Detect Changes

on:
  schedule:
    - cron: '30 */6 * * *'  # 每6小时运行一次，在同步之后
  workflow_dispatch:  # 允许手动触发

jobs:
  detect-changes:
    runs-on: ubuntu-latest
    outputs:
      translation_needed: ${{ steps.check.outputs.translation_needed }}
      file_count: ${{ steps.check.outputs.file_count }}
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        fetch-depth: 0

    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'

    - name: Detect changes between branches
      id: check
      run: |
        chmod +x scripts/detect_changes.sh
        ./scripts/detect_changes.sh

    - name: Upload detected files as artifact
      uses: actions/upload-artifact@v3
      if: success()
      with:
        name: detected-changes-files
        path: /tmp/new_or_modified_files.txt
        retention-days: 1

    - name: Upload translation status as artifact
      uses: actions/upload-artifact@v3
      if: success()
      with:
        name: translation-status
        path: /tmp/translation_status.txt
        retention-days: 1
